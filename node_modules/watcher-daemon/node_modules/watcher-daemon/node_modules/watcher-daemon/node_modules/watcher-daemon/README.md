# Watcher Daemon (TypeScript)

TypeScript source lives in `src/` and compiles into `dist/`.

## Quick Start

```bash
# from repository root
npm install
npm start
```

Or run from the daemon folder:

```bash
cd watcher-daemon
npm install
npm start
```

## Build / Check

```bash
npm run build
npm test
```

`build` compiles TypeScript from `src/` into `dist/`.

## Demo

Run the scripted demo:

```powershell
cd watcher-daemon
.\scripts\demo.ps1
```

Or on macOS/Linux:

```bash
cd watcher-daemon
bash scripts/demo.sh
```

See `DEMO.md` for manual steps and expected output.

## Architecture (Deterministic Core)

- Watcher: emits normalized events (created/modified/deleted) with debounce.
- Rule Compiler (LLM once): converts natural language into structured rules.
- Rule Engine: deterministic evaluation (no LLM) including time-windowed thresholds.
- Rule Store: JSON persistence, restart-safe.
- Notifications: console + OS notifications.

## API (Localhost Only)

- `GET /health`
- `GET /rules`
- `GET /rules/:id`
- `POST /rules`
- `POST /rules/compile` (compile-only, does not store)
- `DELETE /rules/:id`
- `GET /matches`
- `GET /report`

## LLM Availability Behavior

- File watching and deterministic rule evaluation always stay active.
- LLM is only used to compile new rules from natural language.
- If Ollama is unavailable, rule creation is disabled but existing rules keep working.

## Config

Use `.env` (see `.env.example`) for settings such as:
- `WATCH_DIR`
- `DB_PATH`
- `LOG_FILE`
- `OLLAMA_HOST`
- `OLLAMA_MODEL`
- `API_ENABLED`
- `API_PORT`
- `NOTIFICATIONS_ENABLED`
- `WATCH_DEBOUNCE_MS`
- `MATCH_HISTORY_LIMIT`

## Failure Modes (Expected)

- Very large directories can increase memory pressure.
- Very high event rates can cause evaluation lag.
- Extremely broad rules are rejected intentionally.
- Threshold counters reset on restart (in-memory windows).
